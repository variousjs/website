# 设计

一个项目随着功能迭代，项目组人员增加，时间周期变化，通常会遇到以下问题

**1. 开发**

新手接手项目，可能需要一些时间来理清代码逻辑，甚至一些黑魔法的项目结构，项目越大，组件越多，理解的成本就越大

并且随着项目越来越大，组件越来越多，项目开发运行起来可能会越来越慢

**2. 发布**

改动一个小功能，甚至是改动小段文案，都需要将整个应用重新构建打包，随着项目越来越大，构建打包的时间会越来越长，并且修改带来的风险越大，因为有可能修改影响了其他功能

**3. 维护**

通常在一个应用内，组件联系的成本非常低，所以开发过程较少考虑组件的独立性，随着时间推移，组件间的耦合会越来越多并且变得复杂，非常不利于后期维护及优化

**4. 共享**

多系统间的组件共享会带来一些问题，如果某个功能组件多系统需要使用，是抽出公共组件使用还是每个系统单独开发？

前者会带来版本发布安全问题，因为每次系统发布都需要重新版本构建，有可能带上不兼容的组件版本。而后者不利于维护，因为每个系统单独开发了，更新功能需要都修改

此问题还对应出一个新问题，如何快速将 A 系统已有的功能组件复制到 B 系统？

<!-- toc -->

## 案例

以淘宝的用户中心作为例子

![taobao](https://user-images.githubusercontent.com/2193211/152671525-6162d53c-ba48-4e1f-bf54-915e7020d459.jpeg)

对于这个页面，可以对其进行功能区块划分，分成多个组件进行开发

![chunk](https://user-images.githubusercontent.com/2193211/152671526-a115698f-22dd-40db-87f9-734b72f9f04f.png)

可以将页面分成 `A ～ F` 6 个组件进行开发，然后将组件进行组合即可。通常情况下，这样处理并没有多大问题。但是如果系统页面足够多（100+），组件足够多（500+），可能就会遇到以下问题

- 项目代码量越来越大，导致构建，加载速度变慢
- 项目发布出错概率变大，因为组件间互相依赖关联，并且每次发布都要重新构建整个应用，代码修改带来不确定性
- 系统间的组件共享不好处理，例如 C 组件是一个物流信息展示组件，通常可以多系统间复用，但无法直接共享使用

## VariousJS 方案

前置说明：**VariousJS 并不是微前端框架。并不是为了解决多业务多系统项目合并在一起的问题**

1. 在 VariousJS 体系下，任何页面/功能/小部件都可以认为是一个组件。组件代码独立，独立开发，互不干扰
2. VariousJS 提供方便安全的通信方式，让组件互相分离又可以方便的进行联系
3. VariousJS 不推崇 monorepo 方式管理代码，避免项目随着需求变更/增加逐步变得越来越大，耦合变多

针对前面所说的项目遇到的问题，VariousJS 的处理方式为

- 开发：应用细分组件，每个组件独立互不干扰
- 发布：组件独立发布，即使上线的组件出现问题，也不会对其他组件造成影响，提高稳定性
- 维护：组件非常独立，独立维护，测试相关
- 共享：通过配置生成页面，可以快速生成一个页面，组件也可以快速移植到其他系统。并且组件是指定 URL 路径引入，并没有重新构建过程，保证系统稳定

## 技术栈限制

由于 VariousJS 基于 RequireJS + React，所以对应的有以下限制

- 所有组件必须为 React 组件
- 所有组件必须构建打包成 AMD（UMD）格式
